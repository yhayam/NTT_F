<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約画面</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            background: linear-gradient(135deg, #f9fbff 0%, #eef4ff 100%);
            color: #2d3748;
            min-height: 100vh;
        }

        /* ヘッダー */
        .header {
            background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
            color: white;
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 12px rgba(11, 95, 255, 0.2);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .header-logo {
            font-size: 24px;
            font-weight: 700;
        }

        .header-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .attendant-name {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .header-right {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .header-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .header-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        /* レイアウト */
        .layout {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* メインコンテンツ */
        .main-content {
            flex: 1;
            padding: 40px;
            width: 100%;
        }

        .content-header {
            margin-bottom: 30px;
        }

        .content-title {
            font-size: 28px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .content-subtitle {
            font-size: 15px;
            color: #718096;
        }

        /* ツールバー */
        .toolbar {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .toolbar-left {
            display: flex;
            align-items: flex-end;
            gap: 15px;
            flex-wrap: wrap;
        }

        .search-box {
            position: relative;
            display: flex;
            align-items: flex-end;
        }

        .search-input {
            padding: 10px 15px 10px 40px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            width: 300px;
            font-size: 14px;
            height: 42px;
            margin-bottom: 0;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }

        .filter-select {
            padding: 10px 15px;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            background: white;
            height: 42px;
        }
        .filter-group {
            display: flex;
            flex-direction: column;
        }
        .filter-label {
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 6px;
            font-size: 14px;
        }

        /* VIPテーブル */
        .vip-table-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            overflow-y: auto; /* 縦スクロール可能にする */
            overflow-x: auto;
            max-height: calc(100vh - 340px); /* 画面の高さに合わせて高さ制限 */
            padding-bottom: 40px; /* ボトムバーと重ならない余白 */
        }

        .vip-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .vip-table thead {
            background: linear-gradient(135deg, #f7faff 0%, #eef4ff 100%);
        }

        .vip-table th {
            padding: 18px 20px;
            text-align: left;
            font-weight: 600;
            color: #4a5568;
            font-size: 14px;
            border-bottom: 2px solid #e2e8f0;
            white-space: nowrap;
        }

        .vip-table th.sortable {
            cursor: pointer;
            user-select: none;
        }

        .vip-table th.sortable:hover {
            color: #0B5FFF;
        }

        .vip-table tbody tr {
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.2s;
        }

        .vip-table tbody tr:hover {
            background: #fafbff;
        }

        .vip-table tbody tr.selected {
            background: #e6f0ff;
        }

        .vip-table td {
            padding: 20px;
            font-size: 14px;
            color: #2d3748;
        }

        .checkbox-cell {
            width: 50px;
            text-align: center;
        }

        .custom-checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #0B5FFF;
        }

        /* 名前をクリック可能に */
        .member-name-link {
            color: #0B5FFF;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.2s;
            display: inline-block;
        }

        .member-name-link:hover {
            color: #0847b3;
            text-decoration: underline;
        }

        /* 会員情報モーダル */
        .member-info-modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2500;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .member-info-modal-overlay.show {
            display: flex;
        }

        .member-info-modal {
            background: white;
            border-radius: 12px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow: hidden;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            display: flex;
            flex-direction: column;
        }

        .member-info-header {
            background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
            color: white;
            padding: 24px 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-shrink: 0;
        }

        .member-info-title {
            font-size: 20px;
            font-weight: 700;
        }

        .member-info-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 24px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .member-info-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: rotate(90deg);
        }

        /* 編集・保存ボタン */
        .edit-save-btn {
            background: white;
            color: #0B5FFF;
            border: 2px solid white;
            padding: 8px 20px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .edit-save-btn:hover {
            background: rgba(255, 255, 255, 0.9);
        }

        .edit-save-btn.save-mode {
            background: #10b981;
            color: white;
            border-color: #10b981;
        }

        .edit-save-btn.save-mode:hover {
            background: #059669;
        }

        .edit-icon {
            font-size: 16px;
            font-weight: bold;
        }

        /* 編集可能な入力フィールド */
        .info-input {
            font-size: 15px;
            color: #2d3748;
            font-weight: 500;
            padding: 8px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            transition: all 0.3s;
            font-family: 'Noto Sans JP', 'Inter', sans-serif;
            width: 100%;
        }

        .info-input:focus {
            outline: none;
            border-color: #0B5FFF;
            box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.1);
        }

        /* 保存成功メッセージ */
        .save-message {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #10b981;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(16, 185, 129, 0.3);
            display: none;
            align-items: center;
            gap: 12px;
            z-index: 3000;
            animation: slideIn 0.3s ease;
            font-weight: 600;
        }

        .save-message.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .member-info-body {
            padding: 32px;
            overflow-y: auto;
            flex: 1;
        }

        .info-section {
            margin-bottom: 32px;
            padding-bottom: 24px;
            border-bottom: 1px solid #e2e8f0;
        }

        .info-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }

        .info-section-title {
            font-size: 17px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 20px;
            padding-left: 12px;
            border-left: 4px solid #0B5FFF;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        /* 編集マークボタン */
        .edit-mark-btn {
            background: #0B5FFF;
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .edit-mark-btn:hover {
            background: #0847b3;
        }

        .edit-mark-btn.save-mode {
            background: #10b981;
        }

        .edit-mark-btn.save-mode:hover {
            background: #059669;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px 32px;
        }

        .info-row {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .info-label {
            font-size: 13px;
            font-weight: 600;
            color: #64748b;
        }

        .info-value {
            font-size: 15px;
            color: #1e293b;
            font-weight: 500;
            line-height: 1.5;
        }

        .info-value.empty {
            color: #94a3b8;
            font-style: italic;
            font-weight: 400;
        }

        .info-value-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
        }

        .badge-vip {
            color: #0B5FFF;
            border: 2px solid #0B5FFF;
        }

        .badge-staff {
            color: #64748b;
            border: 2px solid #cbd5e1;
        }

        .badge-yes {
            color: #059669;
            border: 2px solid #059669;
        }

        .badge-no {
            color: #dc2626;
            border: 2px solid #dc2626;
        }

        .attendant-list {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .attendant-item {
            padding: 20px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
        }

        .attendant-item-title {
            font-size: 15px;
            font-weight: 700;
            color: #0B5FFF;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #e2e8f0;
        }

        .attendant-item .info-grid {
            gap: 16px 32px;
        }

        @media (max-width: 768px) {
            .member-info-modal {
                width: 100%;
                max-height: 95vh;
            }

            .member-info-header {
                padding: 20px 24px;
            }

            .member-info-title {
                font-size: 18px;
            }

            .member-info-body {
                padding: 24px 20px;
            }

            .info-section {
                margin-bottom: 24px;
                padding-bottom: 20px;
            }

            .info-section-title {
                font-size: 16px;
            }

            .info-grid {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .attendant-item {
                padding: 16px;
            }

            .attendant-item .info-grid {
                gap: 12px;
            }
        }

        /* 予約情報 */
        .reservation-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .reservation-tag {
            background: #f0f4ff;
            color: #0B5FFF;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .reservation-tag .remove-icon {
            cursor: pointer;
            color: #e53e3e;
            font-weight: 700;
        }

        .reservation-tag .remove-icon:hover {
            color: #c53030;
        }

        /* 固定ボトムバー */
        .bottom-bar {
            position: fixed;
            bottom: -100px;
            left: 0;
            right: 0;
            background: white;
            padding: 20px 40px;
            box-shadow: 0 -2px 20px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: bottom 0.3s ease-out;
            z-index: 100;
            flex-wrap: wrap;
            gap: 15px;
        }

        .bottom-bar.show {
            bottom: 0;
        }

        .selected-info {
            font-size: 15px;
            color: #2d3748;
            font-weight: 600;
        }

        .bottom-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .bottom-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .btn-bulk-reserve {
            background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
            color: white;
        }

        .btn-bulk-reserve:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(11, 95, 255, 0.4);
        }


        /* モーダル */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: 700;
            color: #1a202c;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #a0aec0;
            padding: 0;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: #f7faff;
            color: #2d3748;
        }

        .modal-content {
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .form-select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .form-select:focus {
            outline: none;
            border-color: #0B5FFF;
        }

        .selected-members {
            background: #f7faff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .selected-members-title {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .member-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .member-chip {
            background: white;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
            color: #2d3748;
            border: 1px solid #e2e8f0;
        }

        .info-box {
            background: #fff9e6;
            border-left: 4px solid #fbbf24;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .info-box-title {
            font-size: 14px;
            font-weight: 600;
            color: #92400e;
            margin-bottom: 8px;
        }

        .info-box-text {
            font-size: 13px;
            color: #78350f;
            line-height: 1.6;
        }

        .checkbox-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .checkbox-item:hover {
            border-color: #0B5FFF;
            background: #f7faff;
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #0B5FFF;
        }

        .checkbox-item label {
            cursor: pointer;
            font-size: 14px;
            color: #2d3748;
        }

        .time-slots {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 15px;
        }

        .time-slot {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .time-slot:hover {
            border-color: #0B5FFF;
            background: #f7faff;
        }

        .time-slot.selected {
            border-color: #0B5FFF;
            background: #e6f0ff;
        }

        .time-slot-time {
            font-size: 18px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 5px;
        }

        .time-slot-label {
            font-size: 13px;
            color: #718096;
        }

        .modal-actions {
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }

        .modal-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-cancel {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
            color: white;
        }

        .btn-confirm:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(11, 95, 255, 0.4);
        }

        .btn-confirm:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .person-time-group {
            margin-bottom: 25px;
            padding: 20px;
            background: #f7faff;
            border-radius: 12px;
            border: 2px solid #e2e8f0;
        }

        .person-name {
            font-size: 16px;
            font-weight: 700;
            color: #1a202c;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .person-company {
            font-size: 13px;
            color: #718096;
            margin-left: 28px;
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .time-select-label {
            font-size: 14px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .person-select-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 12px;
        }

        .person-select-item:hover {
            border-color: #0B5FFF;
            background: #f7faff;
        }

        .person-select-item input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #0B5FFF;
        }

        .person-info {
            flex: 1;
        }

        .person-info-name {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
            margin-bottom: 4px;
        }

        .person-info-company {
            font-size: 13px;
            color: #718096;
        }

        .person-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .person-card {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .person-card:hover {
            border-color: #0B5FFF;
            background: #f7faff;
            transform: translateY(-2px);
        }

        .person-card.selected {
            border-color: #0B5FFF;
            background: #e6f0ff;
        }

        .person-card-name {
            font-size: 16px;
            font-weight: 600;
            color: #1a202c;
        }

        /* レスポンシブ */
        @media (max-width: 1024px) {
            .main-content {
                padding: 20px;
            }

            .search-input {
                width: 200px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 15px;
            }

            .header-logo {
                font-size: 20px;
            }

            .attendant-name {
                font-size: 12px;
                padding: 6px 12px;
            }

            .main-content {
                padding: 15px;
            }

            .content-title {
                font-size: 22px;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-left {
                flex-direction: column;
                width: 100%;
            }

            .search-input {
                width: 100%;
            }

            .filter-select {
                width: 100%;
            }

            .vip-table-container {
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .bottom-bar {
                padding: 15px 20px;
                flex-direction: column;
                align-items: stretch;
            }

            .bottom-actions {
                flex-direction: column;
                width: 100%;
            }

            .bottom-btn {
                width: 100%;
                text-align: center;
            }

        }

        @media (max-width: 480px) {
            .vip-table th,
            .vip-table td {
                padding: 12px 8px;
                font-size: 12px;
            }

            .reservation-tag {
                font-size: 11px;
                padding: 4px 8px;
            }

            .modal {
                padding: 25px;
            }

            .modal-title {
                font-size: 20px;
            }

            .time-slots {
                grid-template-columns: 1fr;
            }
            .reservation-note {
                 font-size: 13px;
                    color: #4a5568;
                    margin-top: 4px;
}
        }
    </style>
</head>
<body>
    <!-- ログイン画面 -->
    <div id="login-screen" class="login-container" style="display:flex;">
      <div class="login-card">
        <h2 class="login-title">
          <span class="line1">地域ミライ共創フォーラム2026</span><br>
          <span class="line2">予約ページ ログイン</span>
        </h2>
        <p class="login-note">
          ※事前(12月中旬目途）に事務局より各アテンド（正・副）へ URLとID/PWのご案内メールが送られます
        </p>
        <input type="email" id="login-email" placeholder="メールアドレス">
        <input type="password" id="login-password" placeholder="パスワード">
        <button onclick="handleLogin()">ログインする</button>
      </div>
    </div>
    <!-- メイン画面 -->
    <div id="main-screen" style="display:none;">
    <!-- 会員情報モーダル -->
    <div class="member-info-modal-overlay" id="memberInfoModal">
        <div class="member-info-modal">
            <div class="member-info-header">
                <div class="member-info-title">会員情報</div>
                <button class="member-info-close" onclick="closeMemberInfo()">×</button>
            </div>
            <div class="member-info-body" id="memberInfoBody">
                <!-- JavaScriptで動的に生成 -->
            </div>
        </div>
    </div>

    <!-- 保存成功メッセージ -->
    <div class="save-message" id="saveMessage">
        <span style="font-size: 20px; font-weight: bold;">✓</span>
        <span>保存しました</span>
    </div>

    <!-- 予約完了オーバーレイ -->
    <div class="completion-overlay" id="completionOverlay">
        <div class="completion-modal">
            <div class="completion-message">申込完了しました</div>
            <p class="reservation-note">※確定時、メールにてお知らせします</p>
            <button class="completion-close-btn" onclick="closeCompletionScreen()">閉じる</button>
        </div>
    </div>
    <style>
        /* 予約完了オーバーレイ */
        .completion-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            z-index: 3000;
            align-items: center;
            justify-content: center;
        }
        .completion-overlay.show {
            display: flex;
        }
        .completion-modal {
            background: #fff;
            border-radius: 16px;
            padding: 48px 32px 32px 32px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.18);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 300px;
            max-width: 90vw;
        }
        .completion-message {
            font-size: 1.5rem;
            font-weight: 700;
            color: #0B5FFF;
            margin-bottom: 16px;
            text-align: center;
        }
        .reservation-note {
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 32px;
            text-align: center;
        }
        .completion-close-btn {
            margin-top: 16px;
            padding: 12px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
            color: #fff;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.2s;
        }
        .completion-close-btn:hover {
            background: linear-gradient(135deg, #0847b3 0%, #0B5FFF 100%);
        }

        .vip-table-container {
    background: white;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    overflow-y: auto; /* 上下スクロールのみ */
    overflow-x: hidden;
    max-height: calc(100vh - 240px);
    position: relative;
}

/* ヘッダー固定 */
.vip-table thead {
    position: sticky;
    top: 0;
    z-index: 10;
    background: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
}

/* ヘッダーのデザインを統一 */
.vip-table th {
    background: #fff;
    font-weight: 600;
    color: #4a5568;
}

.form-select {
    width: 100%;
    padding: 12px 40px 12px 15px;
    border: 2px solid #e2e8f0;
    border-radius: 8px;
    font-size: 14px;
    color: #1a202c;
    background-color: #ffffff;
    appearance: none;
    background-image: url('data:image/svg+xml;utf8,<svg fill="%230B5FFF" height="20" viewBox="0 0 24 24" width="20" xmlns="http://www.w3.org/2000/svg"><path d="M7 10l5 5 5-5z"/></svg>');
    background-repeat: no-repeat;
    background-position: right 12px center;
    background-size: 16px 16px;
    transition: all 0.2s ease;
}

.form-select:hover {
    border-color: #0B5FFF;
    box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.1);
}

.form-select:focus {
    outline: none;
    border-color: #0B5FFF;
    box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.15);
}

/* ボタンの並びと余白を調整 */
.header-right {
    display: flex;
    gap: 10px;
    align-items: center;
}

        
    </style>
    <!-- ヘッダー -->
    <header class="header">
        <div class="header-left">
            <div class="header-logo">地域ミライ共創フォーラム2026 アテンド専用マイページ（各種予約画面）</div>
            <div class="header-info">
                <div class="attendant-name">
                    <span>担当者：速水柚紀</span>
                </div>
            </div>
        </div>
        <div class="header-right">
            <button class="logout-btn" onclick="confirmLogout()">ログアウト</button>
        </div>
    </header>

    <!-- メインレイアウト -->
    <div class="layout">
        <!-- メインコンテンツ -->
        <main class="main-content">
            <div class="content-header">
                <h1 class="content-title">【アテンドの皆様へのご案内】</h1>
            </div>
            <div class="attend-guide">
            <p><strong>◆各種予約に関して</strong><br>
            ・各種予約は●月●日までに完了をお願いします<br>
            ・三役挨拶は承認制、ツアーは抽選となります。それぞれ確定時に結果をメールにてお知らせします。<br>
            ・招待者の変更については事務局までお知らせください<br>
            ・招待者の変更については事務局までお知らせください<br>
            ・お土産については、お菓子およびグッズのお渡しを想定しておりますが、「社外との接遇等に関するガイドライン」に基づき配布有無のご判断をお願いいたします。
            </p>
            <p><strong>◆イベント当日について</strong><br>
            ・
            </p>
            <p><strong>◆お問い合わせ先</strong><br>
            地域ミライ共創フォーラム2026事務局<br>
            担当：有澤（ありさわ）　<br>
            <a href="mailto:miraiforum2026@almellows.com">miraiforum2026@almellows.com</a><br><br>
            </p>
            </div>
            <div class="content-header">
                <h1 class="content-title">担当招待者/アテンド担当一覧</h1>
            </div>
            <!-- ツールバー -->
            <div class="toolbar">
                <div class="toolbar-left">
                    <div class="search-box">
                        <input type="text" class="search-input" placeholder="氏名・企業名で検索..." id="searchInput">
                    </div>
                    <div class="filter-group">
                        <label for="filterSelect" class="filter-label">予約の有無</label>
                        <select class="filter-select" id="filterSelect">
                            <option value="all">すべて</option>
                            <option value="reserved">予約済のみ</option>
                            <option value="unreserved">未予約のみ</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label for="typeFilter" class="filter-label">会員種別</label>
                        <select class="filter-select" id="typeFilter">
                            <option value="all">すべて</option>
                            <option value="guest">VIP</option>
                            <option value="ntt">アテンド担当</option>
                        </select>
                    </div>
                </div>
            </div>
            <!-- VIPテーブル -->
            <div class="vip-table-container">
                <table class="vip-table">
                    <thead>
                        <tr>
                            <th class="checkbox-cell"></th>
                            <th class="sortable">氏名 </th>
                            <th class="sortable">企業名 </th>
                            <th>会員属性</th>
                            <th>予約一覧</th>
                            <th style="text-align: center;">記念品の選択</th>
                        </tr>
                    </thead>
                    <tbody id="vipTableBody">
                        <!-- データはJavaScriptで動的に生成 -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- 固定ボトムバー -->
    <div class="bottom-bar" id="bottomBar">
        <div class="selected-info">
            <span id="selectedCount">0</span>名を選択中
        </div>
        <div class="bottom-actions">
            <button class="bottom-btn btn-bulk-reserve" onclick="openTicketModal('tour')">
                展示ツアーを予約
            </button>
            <button class="bottom-btn btn-bulk-reserve" onclick="openTicketModal('lunch')">
                お弁当を予約
            </button>
            <button class="bottom-btn btn-bulk-reserve" onclick="openTicketModal('greeting')">
                三役挨拶を予約
            </button>
            <button class="bottom-btn btn-bulk-reserve" onclick="downloadAllBadges()">
                バッジ一括ダウンロード
            </button>
        </div>
    </div>


    <!-- 展示ツアー予約モーダル -->
    <div class="modal-overlay" id="tourModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">展示ツアー予約（抽選制）</h2>
                <button class="modal-close" onclick="closeTourModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="selected-members">
                    <div class="selected-members-title">選択中の招待者</div>
                    <div class="member-list" id="tourMemberList"></div>
                </div>

                <div class="info-box">
                    <div class="info-box-title">ツアー情報</div>
                    <div class="info-box-text">
                        ・特別展示＋e-City Labo展示ツアー<br>
                        ・1グループ約10名（複数社混成）<br>
                        ・第一希望・第二希望で抽選を行います
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">第一希望</label>
                    <select class="form-select" id="tourFirstChoice">
                        <option value="">選択してください</option>
                        <option value="morning">午前の回（11:00-12:00）</option>
                        <option value="afternoon">午後の回（15:00-16:00）</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">第二希望</label>
                    <select class="form-select" id="tourSecondChoice">
                        <option value="">選択してください</option>
                        <option value="morning">午前の回（11:00-12:00）</option>
                        <option value="afternoon">午後の回（15:00-16:00）</option>
                    </select>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-cancel" onclick="closeTourModal()">キャンセル</button>
                <button class="modal-btn btn-confirm" onclick="confirmTourReservation()">申込する</button>
            </div>
        </div>
    </div>

    <!-- お弁当予約モーダル -->
    <div class="modal-overlay" id="lunchModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">お弁当予約</h2>
                <button class="modal-close" onclick="closeLunchModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="selected-members">
                    <div class="selected-members-title">選択中の招待者/アテンド担当者</div>
                    <div class="member-list" id="lunchMemberList"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-cancel" onclick="closeLunchModal()">キャンセル</button>
                <button class="modal-btn btn-confirm" onclick="confirmLunchReservation()">申込する</button>
            </div>
        </div>
    </div>

    <!-- 三役挨拶予約モーダル - ステップ1: 人物選択 -->
    <div class="modal-overlay" id="greetingModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">三役挨拶予約 - 三役選択</h2>
                <button class="modal-close" onclick="closeGreetingModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="info-box">
                    <div class="info-box-title">三役選択</div>
                    <div class="info-box-text">
                        三役挨拶を行う人物を選択してください
                    </div>
                </div>

                <div id="greetingPersonList" class="person-grid">
                    <!-- JavaScriptで動的に生成 -->
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-cancel" onclick="closeGreetingModal()">キャンセル</button>
                <button class="modal-btn btn-confirm" onclick="proceedToTimeSelection()" disabled id="greetingNextBtn">次へ（時間選択）</button>
            </div>
        </div>
    </div>

    <!-- 三役挨拶予約モーダル - ステップ2: 時間選択 -->
    <div class="modal-overlay" id="greetingTimeModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">三役挨拶予約 - 時間選択</h2>
                <button class="modal-close" onclick="closeGreetingTimeModal()">×</button>
            </div>
            <div class="modal-content">
                <div class="selected-members">
                    <div class="selected-members-title">選択中の人物</div>
                    <div class="member-list">
                        <div class="member-chip" id="selectedPersonName"></div>
                    </div>
                </div>

                <div class="info-box">
                    <div class="info-box-title">時間選択</div>
                    <div class="info-box-text">
                        三役挨拶の時間を選択してください
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">時間を選択</label>
                    <div class="time-slots">
                        <div class="time-slot" onclick="selectGreetingTime('13:00')">
                            <div class="time-slot-time">13:00〜</div>
                            <div class="time-slot-label">午後枠①</div>
                        </div>
                        <div class="time-slot" onclick="selectGreetingTime('14:00')">
                            <div class="time-slot-time">14:00〜</div>
                            <div class="time-slot-label">午後枠②</div>
                        </div>
                        <div class="time-slot" onclick="selectGreetingTime('15:00')">
                            <div class="time-slot-time">15:00〜</div>
                            <div class="time-slot-label">午後枠③</div>
                        </div>
                        <div class="time-slot" onclick="selectGreetingTime('16:00')">
                            <div class="time-slot-time">16:00〜</div>
                            <div class="time-slot-label">午後枠④</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="modal-btn btn-cancel" onclick="backToPersonSelection()">← 戻る</button>
                <button class="modal-btn btn-confirm" onclick="confirmGreetingReservation()" disabled id="greetingConfirmBtn">申込する</button>
            </div>
        </div>
    </div>

    </div> <!-- /#main-screen -->
    <!-- ログアウト確認モーダル -->
    <div id="logout-modal" class="logout-overlay" style="display:none;">
      <div class="logout-modal">
        <p>ログアウトしますか？</p>
        <div class="btn-row">
          <button onclick="handleLogout()">はい</button>
          <button onclick="closeLogoutModal()">いいえ</button>
        </div>
      </div>
    </div>
    <script>
        // サンプルデータ
        const vipData = [
    {
        id: 1,
        name: '金城清美',
        company: 'bravesoft株式会社',
        email: 'kaneshiro@bravesoft.co.jp',
        reservations: ['展示ツアー 10:00~11:00枠', 'お弁当', '三役挨拶 13:00~'],
        gift: 'お菓子＋グッズ',
        type: 'guest',
        hasInvitationTicket: true,
        // 詳細情報
        details: {
            organization: '開発部',
            position: '部長',
            category1: 'VIP',
            category2: '共創パートナー',
            category3: '民間企業',
            keynote: '参加する',
            focusExhibit: 'A展示',
            inviteOrg: {
                orgName: 'NTT東日本 神奈川事業部',
                department: '法人営業部',
                contact: '山田太郎',
                phone: '045-123-4567'
            },
            mainAttendant: {
                position: '課長',
                name: '佐藤一郎',
                email: 'sato@ntt-east.co.jp'
            },
            subAttendant: {
                position: '主任',
                name: '鈴木花子',
                email: 'suzuki@ntt-east.co.jp'
            },
            additionalAttendants: [
                { position: '担当', name: '田中太郎', email: 'tanaka@ntt-east.co.jp' },
                { position: '担当', name: '高橋美咲', email: 'takahashi@ntt-east.co.jp' }
            ]
        }
    },
    {
        id: 2,
        name: '小出拓磨',
        company: 'テスト株式会社',
        email: 'koide@test.co.jp',
        reservations: ['展示ツアー 11:00~12:00枠', '三役挨拶 13:00~'],
        gift: 'グッズのみ',
        type: 'guest',
        hasInvitationTicket: true,
        details: {
            organization: '営業本部',
            position: '課長',
            category1: 'VIP',
            category2: '共創パートナー',
            category3: '民間企業',
            keynote: '不参加',
            focusExhibit: 'B展示',
            inviteOrg: {
                orgName: 'NTT東日本 東京事業部',
                department: '営業部',
                contact: '伊藤次郎',
                phone: '03-1234-5678'
            },
            mainAttendant: {
                position: '係長',
                name: '中村三郎',
                email: 'nakamura@ntt-east.co.jp'
            },
            subAttendant: {
                position: '担当',
                name: '小林美咲',
                email: 'kobayashi@ntt-east.co.jp'
            },
            additionalAttendants: []
        }
    },
    {
        id: 3,
        name: '鈴木一郎',
        company: '株式会社テクノロジー',
        email: 'suzuki@technology.co.jp',
        reservations: ['お弁当'],
        gift: '',
        type: 'guest',
        hasInvitationTicket: true,
        details: {
            organization: '技術部',
            position: '部長',
            category1: 'VIP',
            category2: '共創パートナー（候補）',
            category3: '民間企業',
            keynote: '参加する',
            focusExhibit: 'A展示',
            inviteOrg: { orgName: 'NTT東日本', department: '営業部', contact: '担当者名', phone: '00-0000-0000' },
            mainAttendant: { position: '課長', name: 'メイン担当', email: 'main@ntt.co.jp' },
            subAttendant: { position: '担当', name: 'サブ担当', email: 'sub@ntt.co.jp' },
            additionalAttendants: []
        }
    },
    {
        id: 4,
        name: '田中美咲',
        company: 'イノベーション株式会社',
        email: 'tanaka@innovation.co.jp',
        reservations: [],
        gift: '',
        type: 'guest',
        hasInvitationTicket: true,
        details: {
            organization: 'マーケティング部',
            position: '課長',
            category1: 'VIP',
            category2: 'メディア',
            category3: '民間企業',
            keynote: '不参加',
            focusExhibit: 'B展示',
            inviteOrg: { orgName: 'NTT東日本', department: '営業部', contact: '担当者名', phone: '00-0000-0000' },
            mainAttendant: { position: '課長', name: 'メイン担当', email: 'main@ntt.co.jp' },
            subAttendant: { position: '担当', name: 'サブ担当', email: 'sub@ntt.co.jp' },
            additionalAttendants: []
        }
    },
    {
        id: 5,
        name: '山田太郎',
        company: 'NTT東日本',
        email: 'yamada@ntt-east.co.jp',
        reservations: ['お弁当', '三役挨拶 14:00~'],
        gift: '',
        type: 'ntt',
        hasInvitationTicket: false,
        details: {
            organization: '法人営業部',
            position: '担当',
            category1: '担当者',
            category2: '-',
            category3: '-',
            keynote: '-',
            focusExhibit: '-',
            inviteOrg: { orgName: '-', department: '-', contact: '-', phone: '-' },
            mainAttendant: { position: '-', name: '-', email: '-' },
            subAttendant: { position: '-', name: '-', email: '-' },
            additionalAttendants: []
        }
    },
    {
        id: 6,
        name: '佐藤花子',
        company: 'NTT東日本',
        email: 'sato@nttdata.co.jp',
        reservations: [],
        gift: '',
        type: 'ntt',
        hasInvitationTicket: false,
        details: {
            organization: '営業部',
            position: '担当',
            category1: '担当者',
            category2: '-',
            category3: '-',
            keynote: '-',
            focusExhibit: '-',
            inviteOrg: { orgName: '-', department: '-', contact: '-', phone: '-' },
            mainAttendant: { position: '-', name: '-', email: '-' },
            subAttendant: { position: '-', name: '-', email: '-' },
            additionalAttendants: []
        }
    },
    {
        id: 7,
        name: '高橋健太',
        company: 'NTT東日本',
        email: 'takahashi@ntt-west.co.jp',
        reservations: ['展示ツアー 10:00~11:00枠', 'お弁当'],
        gift: '',
        type: 'ntt',
        hasInvitationTicket: false,
        details: {
            organization: '営業部',
            position: '係長',
            category1: '担当者',
            category2: '-',
            category3: '-',
            keynote: '-',
            focusExhibit: '-',
            inviteOrg: { orgName: '-', department: '-', contact: '-', phone: '-' },
            mainAttendant: { position: '-', name: '-', email: '-' },
            subAttendant: { position: '-', name: '-', email: '-' },
            additionalAttendants: []
        }
    },
];

        // テーブルを描画
        function renderTable() {
            const tbody = document.getElementById('vipTableBody');
            tbody.innerHTML = '';

            vipData.forEach(vip => {
                const tr = document.createElement('tr');
                tr.dataset.id = vip.id;
                tr.dataset.type = vip.type;

                tr.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="custom-checkbox vip-checkbox" data-id="${vip.id}">
                    </td>
                    <td><span class="member-name-link" onclick="showMemberInfo(${vip.id})">${vip.name}</span></td>
                    <td>${vip.company}</td>
                    <td>${vip.type === 'ntt' ? 'アテンド' : '招待者'}</td>
                    <td>
                        <div class="reservation-tags">
                            ${vip.reservations.length > 0 
                                ? vip.reservations.map(r => `
                                    <span class="reservation-tag">
                                        ${r}
                                        <span class="remove-icon" onclick="removeReservation(${vip.id}, '${r}')">×</span>
                                    </span>
                                `).join('')
                                : '<span style="color: #a0aec0;">予約なし</span>'
                            }
                        </div>
                    </td>

                    <td style="text-align: center;">
    <select class="gift-select" onchange="updateGiftSelection(${vip.id}, this.value)">
        <option value="">選択してください</option>
        <option value="お菓子＋グッズ" ${vip.gift === 'お菓子＋グッズ' ? 'selected' : ''}>お菓子＋グッズ</option>
        <option value="グッズのみ" ${vip.gift === 'グッズのみ' ? 'selected' : ''}>グッズのみ</option>
        <option value="どちらも渡さない" ${vip.gift === 'どちらも渡さない' ? 'selected' : ''}>どちらも渡さない</option>
        <option value="不要（アテンド用）" ${vip.gift === '不要（アテンド用）' ? 'selected' : ''}>不要（アテンド用）</option>
    </select>
</td>
                `;

                tbody.appendChild(tr);
            });

            // チェックボックスイベント
            document.querySelectorAll('.vip-checkbox').forEach(cb => {
                cb.addEventListener('change', updateSelection);
            });
        }

        // 選択状態を更新
        function updateSelection() {
    const checkboxes = document.querySelectorAll('.vip-checkbox:checked');
    const bottomBar = document.getElementById('bottomBar');
    const selectedCount = document.getElementById('selectedCount');

    selectedCount.textContent = checkboxes.length;

    if (checkboxes.length > 0) {
        bottomBar.classList.add('show');

        // 一番下の選択行を中央付近にスクロール
        const lastChecked = checkboxes[checkboxes.length - 1];
        const row = lastChecked.closest('tr');
        if (row) {
            const rowRect = row.getBoundingClientRect();
            const windowHeight = window.innerHeight;
            const bottomBarHeight = document.getElementById('bottomBar').offsetHeight;
            
            if (rowRect.bottom > windowHeight - bottomBarHeight) {
                row.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }
    } else {
        bottomBar.classList.remove('show');
    }

    // 行のハイライト
    document.querySelectorAll('.vip-table tbody tr').forEach(row => {
        const checkbox = row.querySelector('.vip-checkbox');
        row.classList.toggle('selected', checkbox && checkbox.checked);
    });
}

        // 予約モーダルを開く（チケット種別ごと）
        function openTicketModal(ticketType) {
            const selected = document.querySelectorAll('.vip-checkbox:checked');
            if (selected.length === 0) {
                return;
            }

            const selectedMembers = [];
            let hasInvalidMember = false;

            selected.forEach(cb => {
                const id = cb.dataset.id;
                const vip = vipData.find(v => v.id == id);
                if (vip) {
                    // ✅ 展示ツアー・三役挨拶は招待者のみ予約可能
                    if (['tour', 'greeting'].includes(ticketType) && !vip.hasInvitationTicket) {
                        hasInvalidMember = true;
                    }
                    selectedMembers.push(vip);
                }
            });

            // ❌ アテンド（招待チケットなし）が含まれていたら警告
            if (hasInvalidMember) {
                alert('アテンド担当はこの予約を行うことはできません。');
                return;
            }

            // ✅ 通常動線
            if (ticketType === 'tour') {
                showTourModal(selectedMembers);
            } else if (ticketType === 'lunch') {
                showLunchModal(selectedMembers);
            } else if (ticketType === 'greeting') {
                showGreetingModal(selectedMembers);
            }
        }

        // 展示ツアーモーダル
        function showTourModal(members) {
            const memberList = document.getElementById('tourMemberList');
            memberList.innerHTML = members.map(m => 
                `<div class="member-chip">${m.name}</div>`
            ).join('');
            
            document.getElementById('tourModal').classList.add('show');
        }

        function closeTourModal() {
            document.getElementById('tourModal').classList.remove('show');
            document.getElementById('tourFirstChoice').value = '';
            document.getElementById('tourSecondChoice').value = '';
        }

        function confirmTourReservation() {
            const first = document.getElementById('tourFirstChoice').value;
            const second = document.getElementById('tourSecondChoice').value;

            if (!first) {
                return;
            }

            if (!second) {
                return;
            }

            if (first === second) {
                return;
            }

            const firstLabel = first === 'morning' ? '午前の回（11:00-12:00）' : '午後の回（15:00-16:00）';
            const secondLabel = second === 'morning' ? '午前の回（11:00-12:00）' : '午後の回（15:00-16:00）';

            // 選択されたVIPに予約を追加
            const selected = document.querySelectorAll('.vip-checkbox:checked');
            selected.forEach(cb => {
                const id = cb.dataset.id;
                const vip = vipData.find(v => v.id == id);
                if (vip) {
                    // 既存の展示ツアー予約を削除
                    vip.reservations = vip.reservations.filter(r => !r.includes('展示ツアー'));
                    // 新しい予約を追加（抽選待ちとして）
                    vip.reservations.push(`展示ツアー（抽選待ち：第一希望${firstLabel}）`);
                }
            });

            renderTable();
            closeTourModal();
            showCompletionScreen();
        }

        // お弁当モーダル
        function showLunchModal(members) {
            const memberList = document.getElementById('lunchMemberList');
            memberList.innerHTML = members.map(m => 
                `<div class="member-chip">${m.name}</div>`
            ).join('');
            
            document.getElementById('lunchModal').classList.add('show');
        }

        function closeLunchModal() {
            document.getElementById('lunchModal').classList.remove('show');
        }

        function confirmLunchReservation() {
            // 選択されたVIPに予約を追加
            const selected = document.querySelectorAll('.vip-checkbox:checked');
            let count = 0;
            selected.forEach(cb => {
                const id = cb.dataset.id;
                const vip = vipData.find(v => v.id == id);
                if (vip && !vip.reservations.includes('お弁当')) {
                    vip.reservations.push('お弁当');
                    count++;
                }
            });

            renderTable();
            closeLunchModal();
            showCompletionScreen();
        }

        // 三役挨拶モーダル（2ステップ: 人物選択 → 時間選択）
        let selectedGreetingPerson = null;
        let selectedGreetingTime = null;
        let availableMembers = [];

        // 三役の人物リスト
        const executiveList = [
            { id: 'exec_1', name: '澁谷 直樹' },
            { id: 'exec_2', name: '池田 敬' },
            { id: 'exec_3', name: '熊谷 敏昌' },
        ];

        function showGreetingModal(members) {
            availableMembers = members;
            selectedGreetingPerson = null;
            selectedGreetingTime = null;

            // ステップ1: 人物選択リストを生成
            const personList = document.getElementById('greetingPersonList');
            personList.innerHTML = executiveList.map(person => `
                <div class="person-card" onclick="selectExecutivePerson('${person.id}', '${person.name}')">
                    <div class="person-card-name">${person.name}</div>
                </div>
            `).join('');

            document.getElementById('greetingModal').classList.add('show');
            document.getElementById('greetingNextBtn').disabled = true;
        }

        function closeGreetingModal() {
            document.getElementById('greetingModal').classList.remove('show');
            selectedGreetingPerson = null;
            selectedGreetingTime = null;
            
            // カードの選択状態をリセット
            document.querySelectorAll('.person-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        function selectExecutivePerson(personId, personName) {
            selectedGreetingPerson = { id: personId, name: personName };
            
            // すべてのカードの選択を解除
            document.querySelectorAll('.person-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // クリックされたカードを選択状態に
            event.target.closest('.person-card').classList.add('selected');
            
            // 次へボタンを有効化
            document.getElementById('greetingNextBtn').disabled = false;
        }

        function proceedToTimeSelection() {
            if (!selectedGreetingPerson) {
                return;
            }

            // 選択された人物の名前を表示
            document.getElementById('selectedPersonName').textContent = selectedGreetingPerson.name;

            // ステップ1を閉じてステップ2を開く
            document.getElementById('greetingModal').classList.remove('show');
            document.getElementById('greetingTimeModal').classList.add('show');

            // タイムスロットをリセット
            document.querySelectorAll('#greetingTimeModal .time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            document.getElementById('greetingConfirmBtn').disabled = true;
        }

        function closeGreetingTimeModal() {
            document.getElementById('greetingTimeModal').classList.remove('show');
            selectedGreetingPerson = null;
            selectedGreetingTime = null;
        }

        function backToPersonSelection() {
            document.getElementById('greetingTimeModal').classList.remove('show');
            document.getElementById('greetingModal').classList.add('show');
            selectedGreetingTime = null;
        }

        function selectGreetingTime(time) {
            selectedGreetingTime = time;
            
            // すべてのタイムスロットの選択を解除
            document.querySelectorAll('#greetingTimeModal .time-slot').forEach(slot => {
                slot.classList.remove('selected');
            });
            
            // クリックされたスロットを選択状態に
            event.target.closest('.time-slot').classList.add('selected');
            
            // 確定ボタンを有効化
            document.getElementById('greetingConfirmBtn').disabled = false;
        }

        function confirmGreetingReservation() {
            if (!selectedGreetingPerson || !selectedGreetingTime) {
                return;
            }

            // 選択されたVIP全員に予約を追加
            const selectedVips = document.querySelectorAll('.vip-checkbox:checked');
            selectedVips.forEach(cb => {
                const vipId = cb.dataset.id;
                const vip = vipData.find(v => v.id == vipId);
                if (vip) {
                    // 既存の三役挨拶予約を削除
                    vip.reservations = vip.reservations.filter(r => !r.includes('三役挨拶'));
                    // 新しい予約を追加（人物名 + 時間）
                    vip.reservations.push(`三役挨拶 ${selectedGreetingPerson.name} ${selectedGreetingTime}~`);
                }
            });

            renderTable();
            closeGreetingTimeModal();
            showCompletionScreen();
        }

        // 予約削除
        function removeReservation(id, reservation) {
            if (confirm(`「${reservation}」をキャンセルしますか？`)) {
                const vip = vipData.find(v => v.id === id);
                if (vip) {
                    // 文字列のトリム＆完全一致判定で削除
                    vip.reservations = vip.reservations.filter(r => r.trim() !== reservation.trim());
                    
                    renderTable();
                }
            }
        }

        // 基本講演トグル
        // 記念品選択を更新
function updateGiftSelection(id, value) {
    const vip = vipData.find(v => v.id === id);
    if (vip) {
        vip.gift = value;
    }
}


        // 検索
        document.getElementById('searchInput').addEventListener('input', function(e) {
            const query = e.target.value.toLowerCase();
            document.querySelectorAll('.vip-table tbody tr').forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(query) ? '' : 'none';
            });
        });

        // フィルター
        document.getElementById('filterSelect').addEventListener('change', function(e) {
            applyFilters();
        });

        // 招待者/アテンド担当フィルター
        document.getElementById('typeFilter').addEventListener('change', function(e) {
            applyFilters();
        });

        function applyFilters() {
            const statusFilter = document.getElementById('filterSelect').value;
            const typeFilter = document.getElementById('typeFilter').value;

            document.querySelectorAll('.vip-table tbody tr').forEach(row => {
                const id = row.dataset.id;
                const type = row.dataset.type;
                const vip = vipData.find(v => v.id == id);
                
                let showRow = true;

                // ステータスフィルター
                if (statusFilter === 'reserved' && vip.reservations.length === 0) {
                    showRow = false;
                } else if (statusFilter === 'unreserved' && vip.reservations.length > 0) {
                    showRow = false;
                }

                // タイプフィルター
                if (typeFilter === 'guest' && type !== 'guest') {
                    showRow = false;
                } else if (typeFilter === 'ntt' && type !== 'ntt') {
                    showRow = false;
                }

                row.style.display = showRow ? '' : 'none';
            });
        }

        // ログイン・ログアウト機能
        let isLoggedIn = false;

        function handleLogin() {
            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value;
            if (email === 'admin@bravesoft.co.jp' && password === 'test1234') {
                isLoggedIn = true;
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('main-screen').style.display = 'block';
            } else {
                alert('メールアドレスまたはパスワードが違います。');
            }
        }

        function confirmLogout() {
            document.getElementById('logout-modal').style.display = 'flex';
        }

        function handleLogout() {
            isLoggedIn = false;
            document.getElementById('logout-modal').style.display = 'none';
            document.getElementById('main-screen').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
        }

        function closeLogoutModal() {
            document.getElementById('logout-modal').style.display = 'none';
        }

        // 会員情報モーダル
        let isEditMode = false;
        let currentMemberId = null;

        function showMemberInfo(id) {
            currentMemberId = id;
            isEditMode = false;
            renderMemberInfo();
            document.getElementById('memberInfoModal').classList.add('show');
        }

        function renderMemberInfo() {
            const vip = vipData.find(v => v.id === currentMemberId);
            if (!vip || !vip.details) return;

            const d = vip.details;
            const modal = document.getElementById('memberInfoModal');
            const body = document.getElementById('memberInfoBody');

            // バッジの生成
            const vipBadge = d.category1 === 'VIP' 
                ? '<span class="info-value-badge badge-vip">VIP</span>' 
                : '<span class="info-value-badge badge-staff">担当者</span>';
            
            const keynoteBadge = d.keynote === '参加する'
                ? '<span class="info-value-badge badge-yes">参加</span>'
                : d.keynote === '不参加'
                ? '<span class="info-value-badge badge-no">不参加</span>'
                : d.keynote;

            body.innerHTML = `
                <div class="info-section">
                    <div class="info-section-title">招待者情報</div>
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-label">氏名</div>
                            <div class="info-value">${vip.name}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">社名</div>
                            <div class="info-value">${vip.company}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">組織</div>
                            <div class="info-value">${d.organization || '<span class="empty">未設定</span>'}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">役職</div>
                            <div class="info-value">${d.position || '<span class="empty">未設定</span>'}</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-section-title">招待者カテゴリー</div>
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-label">VIP or 担当者</div>
                            <div class="info-value">${vipBadge}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">分類</div>
                            <div class="info-value">${d.category2 || '<span class="empty">未設定</span>'}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">組織タイプ</div>
                            <div class="info-value">${d.category3 || '<span class="empty">未設定</span>'}</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-section-title">
                        <span>参加情報</span>
                        <button class="edit-mark-btn ${isEditMode ? 'save-mode' : ''}" onclick="toggleEditMode()">
                            <span>${isEditMode ? '保存' : '編集'}</span>
                        </button>
                    </div>
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-label">基調講演</div>
                            ${isEditMode ? 
                                `<select class="info-input" id="edit_keynote">
                                    <option value="参加する" ${d.keynote === '参加する' ? 'selected' : ''}>参加する</option>
                                    <option value="不参加" ${d.keynote === '不参加' ? 'selected' : ''}>不参加</option>
                                </select>` :
                                `<div class="info-value">${keynoteBadge}</div>`
                            }
                        </div>
                        <div class="info-row">
                            <div class="info-label">重点説明項目</div>
                            ${isEditMode ? 
                                `<select class="info-input" id="edit_focusExhibit">
                                    <option value="">未選択</option>
                                    <option value="A展示" ${d.focusExhibit === 'A展示' ? 'selected' : ''}>A展示</option>
                                    <option value="B展示" ${d.focusExhibit === 'B展示' ? 'selected' : ''}>B展示</option>
                                </select>` :
                                `<div class="info-value">${d.focusExhibit || '<span class="empty">未設定</span>'}</div>`
                            }
                        </div>
                        <div class="info-row">
                            <div class="info-label">記念品の有無</div>
                            ${isEditMode ? 
                                `<select class="info-input" id="edit_gift">
                                    <option value="">未選択</option>
                                    <option value="お菓子＋グッズ" ${vip.gift === 'お菓子＋グッズ' ? 'selected' : ''}>お菓子＋グッズ</option>
                                    <option value="グッズのみ" ${vip.gift === 'グッズのみ' ? 'selected' : ''}>グッズのみ</option>
                                    <option value="どちらも渡さない" ${vip.gift === 'どちらも渡さない' ? 'selected' : ''}>どちらも渡さない</option>
                                    <option value="不要（アテンド用）" ${vip.gift === '不要（アテンド用）' ? 'selected' : ''}>不要（アテンド用）</option>
                                </select>` :
                                `<div class="info-value">${vip.gift || '<span class="empty">未選択</span>'}</div>`
                            }
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-section-title">招待組織</div>
                    <div class="info-grid">
                        <div class="info-row">
                            <div class="info-label">組織名</div>
                            <div class="info-value">${d.inviteOrg?.orgName || '<span class="empty">未設定</span>'}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">事業部・部署名</div>
                            <div class="info-value">${d.inviteOrg?.department || '<span class="empty">未設定</span>'}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">担当者名</div>
                            <div class="info-value">${d.inviteOrg?.contact || '<span class="empty">未設定</span>'}</div>
                        </div>
                        <div class="info-row">
                            <div class="info-label">電話番号</div>
                            <div class="info-value">${d.inviteOrg?.phone || '<span class="empty">未設定</span>'}</div>
                        </div>
                    </div>
                </div>

                <div class="info-section">
                    <div class="info-section-title">アテンド担当者</div>
                    <div class="attendant-list">
                        <div class="attendant-item">
                            <div class="attendant-item-title">アテンド（正）</div>
                            <div class="info-grid">
                                <div class="info-row">
                                    <div class="info-label">役職</div>
                                    <div class="info-value">${d.mainAttendant?.position || '<span class="empty">未設定</span>'}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">氏名</div>
                                    <div class="info-value">${d.mainAttendant?.name || '<span class="empty">未設定</span>'}</div>
                                </div>
                                <div class="info-row" style="grid-column: 1 / -1;">
                                    <div class="info-label">メールアドレス</div>
                                    <div class="info-value">${d.mainAttendant?.email || '<span class="empty">未設定</span>'}</div>
                                </div>
                            </div>
                        </div>

                        <div class="attendant-item">
                            <div class="attendant-item-title">アテンド（副）</div>
                            <div class="info-grid">
                                <div class="info-row">
                                    <div class="info-label">役職</div>
                                    <div class="info-value">${d.subAttendant?.position || '<span class="empty">未設定</span>'}</div>
                                </div>
                                <div class="info-row">
                                    <div class="info-label">氏名</div>
                                    <div class="info-value">${d.subAttendant?.name || '<span class="empty">未設定</span>'}</div>
                                </div>
                                <div class="info-row" style="grid-column: 1 / -1;">
                                    <div class="info-label">メールアドレス</div>
                                    <div class="info-value">${d.subAttendant?.email || '<span class="empty">未設定</span>'}</div>
                                </div>
                            </div>
                        </div>

                        ${Array.from({length: 5}, (_, idx) => {
                            const att = d.additionalAttendants && d.additionalAttendants[idx] ? d.additionalAttendants[idx] : null;
                            return `
                                <div class="attendant-item">
                                    <div class="attendant-item-title">追加アテンド ${idx + 1}</div>
                                    <div class="info-grid">
                                        <div class="info-row">
                                            <div class="info-label">役職</div>
                                            <div class="info-value">${att && att.position ? att.position : '<span class="empty">未設定</span>'}</div>
                                        </div>
                                        <div class="info-row">
                                            <div class="info-label">氏名</div>
                                            <div class="info-value">${att && att.name ? att.name : '<span class="empty">未設定</span>'}</div>
                                        </div>
                                        <div class="info-row" style="grid-column: 1 / -1;">
                                            <div class="info-label">メールアドレス</div>
                                            <div class="info-value">${att && att.email ? att.email : '<span class="empty">未設定</span>'}</div>
                                        </div>
                                    </div>
                                </div>
                            `;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function toggleEditMode() {
            if (isEditMode) {
                // 保存処理
                saveMemberInfo();
            } else {
                // 編集モードに切り替え
                isEditMode = true;
                renderMemberInfo();
            }
        }

        function saveMemberInfo() {
            const vip = vipData.find(v => v.id === currentMemberId);
            if (!vip || !vip.details) return;

            const d = vip.details;

            // イベント情報のみ編集可能
            d.keynote = document.getElementById('edit_keynote')?.value || d.keynote;
            d.focusExhibit = document.getElementById('edit_focusExhibit')?.value || d.focusExhibit;
            vip.gift = document.getElementById('edit_gift')?.value || vip.gift;

            // 編集モード解除
            isEditMode = false;
            renderMemberInfo();

            // テーブルを再描画（変更を反映）
            renderTable();

            // 保存成功メッセージを表示
            showSaveMessage();
        }

        function showSaveMessage() {
            const message = document.getElementById('saveMessage');
            message.classList.add('show');
            setTimeout(() => {
                message.classList.remove('show');
            }, 3000);
        }

        function closeMemberInfo() {
            const modal = document.getElementById('memberInfoModal');
            modal.classList.remove('show');
            isEditMode = false;
            currentMemberId = null;
        }

        // モーダル外クリックで閉じる
        document.addEventListener('click', function(e) {
            const modal = document.getElementById('memberInfoModal');
            if (e.target === modal) {
                closeMemberInfo();
            }
        });

        // バッジ一括ダウンロード（PDF生成）
        async function downloadAllBadges() {
            const selected = document.querySelectorAll('.vip-checkbox:checked');
            if (selected.length === 0) {
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            doc.setFont('helvetica', 'bold');
            doc.setFontSize(18);
            doc.text('VIPバッジ一覧', 20, 20);

            doc.setFont('helvetica', 'normal');
            doc.setFontSize(12);

            let y = 35;
            Array.from(selected).forEach((cb, index) => {
                const vip = vipData.find(v => v.id == cb.dataset.id);
                if (vip) {
                    doc.text(`${index + 1}. ${vip.name}（${vip.company}）`, 20, y);
                    y += 10;
                }
                if (y > 270) {
                    doc.addPage();
                    y = 20;
                }
            });

            doc.save('VIP_Badges.pdf');
        }

        // 初期化
        renderTable();
        // 会員種別フィルターのラベルを「アテンド担当」に統一（念のためJSでoption修正）
        document.querySelectorAll('#typeFilter option').forEach(opt => {
            if (opt.value === 'ntt') {
                opt.textContent = 'アテンド担当';
            }
        });
        // 予約完了オーバーレイの表示
        function showCompletionScreen() {
            var overlay = document.getElementById('completionOverlay');
            overlay.classList.add('show');

            // ✅ チェック状態リセット
            document.querySelectorAll('.vip-checkbox').forEach(cb => cb.checked = false);

            // ✅ 行ハイライト解除
            document.querySelectorAll('.vip-table tbody tr').forEach(row => row.classList.remove('selected'));

            // ✅ ボトムバー非表示＆カウントリセット
            const bottomBar = document.getElementById('bottomBar');
            bottomBar.classList.remove('show');
            document.getElementById('selectedCount').textContent = '0';
        }

        // 予約完了オーバーレイの非表示
        function closeCompletionScreen() {
            var overlay = document.getElementById('completionOverlay');
            overlay.classList.remove('show');
        }
    </script>
    <style>
    .login-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        height: 100vh;
        background: linear-gradient(135deg, #0B5FFF 0%, #60A5FA 100%);
        font-family: 'Noto Sans JP', sans-serif;
    }

    /* 新ログインタイトルデザイン */
    .login-title {
        display: inline-block;
        text-align: center;
        line-height: 1.5;
        margin-bottom: 64px; /* ログイン文字とメールアドレス入力欄の間に余白を追加 */
    }
    .login-title .line1 {
        font-size: 20px;
        font-weight: 700;
        color: #0B5FFF;
        letter-spacing: 0.5px;
        white-space: nowrap; /* 改行を防止 */
    }
    .login-title .line2 {
        font-size: 16px;
        font-weight: 600;
        color: #1a202c;
        letter-spacing: 0.3px;
    }

    .login-card h2,
    .login-card h2 span {
        all: unset;
    }

    .login-card input {
        width: 100%;
        padding: 12px 15px;
        margin-bottom: 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        transition: border-color 0.3s;
    }

    .login-card input:focus {
        outline: none;
        border-color: #0B5FFF;
        box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.15);
    }

    .login-card button {
        width: 100%;
        padding: 12px;
        background: linear-gradient(135deg, #0B5FFF 0%, #0847b3 100%);
        color: white;
        border: none;
        border-radius: 8px;
        font-size: 15px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s;
    }

    .login-card button:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(11, 95, 255, 0.4);
    }

    .login-note {
        margin-top: 16px;
        margin-bottom: 12px;
        font-size: 13px;
        color: #4a5568;
        line-height: 1.6;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(20px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .logout-btn {
        background: #0B5FFF;
        color: white;
        border: none;
        border-radius: 4px;
        padding: 6px 12px;
        cursor: pointer;
        margin-left: auto;
        font-size: 14px;
        font-weight: 500 !important;
        transition: all 0.3s;
    }
    
    .logout-btn:hover {
        background: #0847b3;
        transform: translateY(-2px);
    }
    
    /* 記念品選択セレクトボックス */
    .gift-select {
        padding: 8px 16px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        color: #2d3748;
        background: white;
        cursor: pointer;
        transition: all 0.3s;
        min-width: 180px;
        appearance: none;
        background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234a5568' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
        background-repeat: no-repeat;
        background-position: right 12px center;
        padding-right: 36px;
    }
    
    .gift-select:hover {
        border-color: #0B5FFF;
        box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.1);
    }
    
    .gift-select:focus {
        outline: none;
        border-color: #0B5FFF;
        box-shadow: 0 0 0 3px rgba(11, 95, 255, 0.15);
    }
    
    .gift-select option {
        padding: 10px;
        font-weight: 500;
    }
    /* ログアウト確認モーダル用オーバーレイ */
    .logout-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }
    .logout-modal {
        background: #fff;
        padding: 24px 32px;
        border-radius: 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        text-align: center;
        z-index: 1001;
    }
    .logout-modal p {
        font-size: 18px;
        font-weight: 600;
        color: #111827;
        margin-bottom: 20px;
    }
    .btn-row {
        display: flex;
        justify-content: center;
        gap: 20px;
    }
    .btn-row button {
        padding: 10px 24px;
        font-size: 15px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
    }
    .btn-row button:first-child {
        background: #0B5FFF;
        color: white;
    }
    .btn-row button:first-child:hover {
        background: #0847b3;
    }
    .btn-row button:last-child {
        background: #e5e7eb;
    }
    .btn-row button:last-child:hover {
        background: #d1d5db;
    }
    /* .login-cardの定義は下部で統一 */
    </style>
    <style>
    .login-card {
        background: #ffffff;
        border-radius: 16px;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        padding: 60px 50px;
        text-align: center;
        width: min(480px, 90%);
        animation: fadeIn 0.6s ease;
    }
    </style>
</body>
</html>
